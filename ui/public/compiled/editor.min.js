var ChessIsEditor;ChessIsEditor=(()=>{var t={734:(t,e)=>{"use strict";function n(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function r(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0,i=document.createElement(t),l=e.cls,s=n(e,["cls"]);return l&&(l.forEach?l.forEach((function(t){i.classList.add(t)})):i.classList.add(l)),Object.keys(s).forEach((function(t){i.setAttribute(t,s[t])})),r.forEach?r.forEach((function(t){i.appendChild(t)})):i.append(r),o&&o(i),i}Object.defineProperty(e,"__esModule",{value:!0}),e.tag=r,e.prepend=function(t,e){t.insertBefore(e,t.children[0])},e.findKlass=function(t,e){return t.getElementsByClassName(e)},e.findTag=function(t,e){return t.getElementsByTagName(e)},e.findId=function(t,e){return document.getElementById(e)},e.parse=function(t){return(new DOMParser).parseFromString(t,"text/html").body},e.fShow=e.fHide=e.fListen=e.fAttribute=e.fAddClass=e.fTranslateAbs=e.updateChildren=e.textNode=e.span=e.div=void 0,e.div=function(t,e,n){return r("div",t,e,n)},e.span=function(t,e,n){return r("span",t,e,n)},e.textNode=function(t){return document.createTextNode(t)},e.updateChildren=function(t,e){for(t=t.firstChild;t;)e(t),t=t.nextSibling},e.fTranslateAbs=function(t){return function(e){e.style.transform="translate(".concat(t[0],"px,").concat(t[1],"px)")}},e.fAddClass=function(t){return function(e){t.split(".").forEach((function(t){e.classList.add(t)}))}},e.fAttribute=function(t){return function(e){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}},e.fListen=function(t,e){return function(n){n.addEventListener(t,(function(){e(n)}))}},e.fHide=function(t){t.classList.contains("hidden")||t.classList.add("hidden")},e.fShow=function(t){t.classList.contains("hidden")&&t.classList.remove("hidden")}},980:(t,e,n)=>{"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}e.Z=l;var o=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(Object.prototype.hasOwnProperty.call(t,l)){var s=o?Object.getOwnPropertyDescriptor(t,l):null;s&&(s.get||s.set)?Object.defineProperty(n,l,s):n[l]=t[l]}return n.default=t,e&&e.set(t,n),n}(n(734));function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function l(t,e,n){var r=o.parse(t),i=o.div({id:"modal-wrap"},[o.span({cls:"close"})]),s=o.div({id:"modal-overlay",cls:"".concat(e)},[],o.fListen("click",l.close));for(s.appendChild(i);r.childNodes[0];)i.appendChild(r.childNodes[0]);return l.onClose=n,o.fListen("click",l.close)(o.findKlass(i,"close")[0]),o.prepend(o.findTag(document,"body")[0],s),i}l.close=function(){var t=o.findId(document,"modal-overlay");l.onClose&&l.onClose(),t.remove(),delete l.onClose}},973:(t,e,n)=>{"use strict";n.r(e),n.d(e,{app:()=>s,boot:()=>o});var r=n(980);function o(t){const e=document.getElementById("chessed"),{data:n}=t;let o;t.$_=e,o=window.ChessIsEditor.app(t);let i=document.getElementById("help");i.addEventListener("click",(t=>{t.preventDefault(),cishard.loadCssPath("help"),fetch(i.href,{}).then((t=>{t.text().then((t=>{(0,r.Z)(t,"help",(()=>{}))}))}))}))}var i=n(191),l=n.n(i);function s(t){let e=t.data;l()(t.$_,{content:e.draft})}},191:t=>{window,t.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){window,t.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){n(2),n(3),n(4),n(5);const r=n(6);t.exports=r.app},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"files",(function(){return O})),n.d(r,"ranks",(function(){return C})),n.d(r,"allKeys",(function(){return j})),n.d(r,"pos2key",(function(){return S})),n.d(r,"key2pos",(function(){return P})),n.d(r,"black",(function(){return L})),n.d(r,"white",(function(){return M})),n.d(r,"asWhite",(function(){return A})),n.d(r,"flip",(function(){return B})),n.d(r,"readShapes",(function(){return R})),n.d(r,"readFen",(function(){return $})),n.d(r,"readMoves",(function(){return K})),n.d(r,"readPly",(function(){return F})),n.d(r,"writeFen",(function(){return N})),n.d(r,"fPosToTranslateAbs",(function(){return I}));var o={};n.r(o),n.d(o,"tag",(function(){return U})),n.d(o,"div",(function(){return J})),n.d(o,"textNode",(function(){return tt})),n.d(o,"updateChildren",(function(){return et})),n.d(o,"fTranslateAbs",(function(){return nt})),n.d(o,"fAddClass",(function(){return rt})),n.d(o,"fAttribute",(function(){return ot})),n.d(o,"fListen",(function(){return it})),n.d(o,"fHide",(function(){return lt})),n.d(o,"fShow",(function(){return st}));var i={};function l(t){let e={};for(let n in t)e[n]=t[n];return e}function s(t,e){let n={};return Object.keys(t).forEach((r=>{let o=e(r,t[r]),i=Object.keys(o)[0];n[i]=o[i]})),n}function u(t,e){Object.keys(t).forEach((n=>e(n,t[n])))}function a(t){this.index=t,this.char=String.fromCharCode(97+t)}function c(t){this.index=t,this.char=String.fromCharCode(49+t)}n.r(i),n.d(i,"svg",(function(){return ut})),n.d(i,"renderShape",(function(){return at})),n.d(i,"renderMarker",(function(){return pt}));const f={A:new a(0),B:new a(1),C:new a(2),D:new a(3),E:new a(4),F:new a(5),G:new a(6),H:new a(7),of:t=>new a(7&t.index)},d=t=>new c(t.index>>3);function p(t){this.index=t;let e=f.of(this),n=d(this);this.file=e,this.rank=n,this.key=e.char+n.char,this.hore=(t,e)=>{let n=e(this);return n?[n,...t(n)?[]:n.hore(t,e)]:[]},this.righte=t=>this.hore(t,(t=>t.right())),this.lefte=t=>this.hore(t,(t=>t.left())),this.down=()=>h.at(e.index,n.index-1),this.left=()=>h.at(e.index-1,n.index),this.downLeft=()=>h.at(e.index-1,n.index-1),this.downRight=()=>h.at(e.index+1,n.index-1),this.up=()=>h.at(e.index,n.index+1),this.right=()=>h.at(e.index+1,n.index),this.upLeft=()=>h.at(e.index-1,n.index+1),this.upRight=()=>h.at(e.index+1,n.index+1)}const h={apply:t=>new p(t),atfr:(t,e)=>new p(t.index+8*e.index),at:(t,e)=>0<=t&&t<8&&0<=e&&e<8?new p(t+8*e):null},y=[];for(let t=0;t<64;t++)y.push(t);h.all=y.map((t=>new p(t))),h.allKeys={},h.all.forEach((t=>h.allKeys[t.key]=t)),h.fromKey=t=>h.allKeys[t],h.A1=new p(0),h.B1=new p(1),h.C1=new p(2);const m={forsyth:"P",roleString:"pawn"},g={forsyth:"N",roleString:"knight",dirs:[t=>h.at(t.file.index-1,t.rank.index+2),t=>h.at(t.file.index-1,t.rank.index-2),t=>h.at(t.file.index+1,t.rank.index+2),t=>h.at(t.file.index+1,t.rank.index-2),t=>h.at(t.file.index-2,t.rank.index+1),t=>h.at(t.file.index-2,t.rank.index-1),t=>h.at(t.file.index+2,t.rank.index+1),t=>h.at(t.file.index+2,t.rank.index-1)]},v={forsyth:"B",roleString:"bishop",dirs:[t=>t.upLeft(),t=>t.upRight(),t=>t.downLeft(),t=>t.downRight()]},b={color:t=>({role:"rook",color:t}),forsyth:"R",roleString:"rook",dirs:[t=>t.up(),t=>t.down(),t=>t.left(),t=>t.right()]},w={forsyth:"Q",roleString:"queen",dirs:[b.dirs,v.dirs].flat()},k={color:t=>({role:"king",color:t}),forsyth:"K",roleString:"king",dirs:w.dirs},x={all:[k,w,v,b,m,g],allByRole:{}};x.all.forEach((t=>x.allByRole[t.roleString]=t)),x.allByForsyth={},x.all.forEach((t=>x.allByForsyth[t.forsyth]=t)),x.forsyth=t=>x.allByForsyth[t];const E={key:"g",color:"#15781B",opacity:1,lineWidth:10},O=["a","b","c","d","e","f","g","h"],C=["1","2","3","4","5","6","7","8"],j=Array.prototype.concat(...O.map((t=>C.map((e=>t+e))))),S=t=>j[8*t[0]+t[1]],P=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],L="black",M="white";function A(t){return t===M}function B(t){return t===M?L:M}let T={w:M,b:L},_={k:"king",q:"queen",r:"rook",b:"bishop",n:"knight",p:"pawn"};function R(t){return t?t.split(" ").map((t=>{let[e,n]=t.split("-");return{orig:e,dest:n,brush:E}})):[]}function $(t){let[e,n,r,o]=t.split(" "),i=T[n],l={};return e.split("/").forEach(((t,e)=>{e=7-e;let n=0;for(let r of t){let t,o;(t=_[r])?o=L:(t=_[r.toLowerCase()])&&(o=M),o?(l[S([n,e])]={role:t,color:o},n++):n+=parseInt(r)}})),{pieces:l,color:i}}function K(t){const e=/^(\d*)\.\.\.$/,n=/^(\d*)\.$/;let r,o,i=[];return t.split(" ").forEach((t=>{let l;(l=t.match(e))?(o=2*parseInt(l[0]),r=[null]):(l=t.match(n))?(o=2*parseInt(l[0])-1,r=[]):(l=moveMatch(t))&&(r.push({ply:o,...l}),o++,2===r.length&&(i.push(r),r=[]))})),1===r.length&&i.push(r),{moves:i}}function F(t){return parseInt(t)}function N({pieces:t}){let e="";for(let n=7;n>=0;n--){let r=0;for(let o=0;o<=7;o++){let i;if(i=t[S([o,n])]){r>0&&(e+=r,r=0);let t=x.allByRole[i.role];e+=i.color===M?t.forsyth.toUpperCase():t.forsyth.toLowerCase()}else r++}r>0&&(e+=r),e+="/"}return e}const I=t=>{const e=t.width/8,n=t.height/8;return(t,r)=>((t,e,n,r)=>[(e?t[0]:7-t[0])*n,(e?7-t[1]:t[1])*r])(t,r,e,n)};function q(t){return{value:t}}function D(t){return{invalid:t}}function W(t,e){return t?q(t):D(e)}const H={name:"king",castledKingFile:f.G,castledRookFile:f.F,tripToRook:(t,e)=>t.righte((t=>e.pieces[t.key]))},V={name:"queen",castledKingFile:f.C,castledRookFile:f.D,tripToRook:(t,e)=>t.lefte((t=>e.pieces[t.key]))};function Q(t,e){this.take=n=>{let r=l(t);return delete r[n.key],new Q(r,e)},this.place=(n,r)=>{let o=l(t);return o[r.key]=n,new Q(o,e)},this.move=(n,r)=>{let o=l(t);return o[r.key]=o[n.key],delete o[n.key],new Q(o,e)},this.taking=(n,r)=>{let o=l(t);return o[r.key]=o[n.key],delete o[n.key],new Q(o,e)},this.actorsOf=()=>{let[t,e]=function(t,e){let n=[],r=[];return t.forEach((t=>(t=>"white"===t.color)(t)?n.push(t):r.push(t))),[n,r]}(Object.values(this.actors));return{white:t,black:e}},this.kingPosOf=e=>{let n=Object.keys(t).find((n=>{let r=t[n];return r.color===e&&"king"===r.role}));return h.fromKey(n)},this.actorAt=t=>this.actors[t],this.color=e,this.pieces=t,this.actors=s(t,((t,e)=>({[t]:new X(e,h.fromKey(t),this)})))}function Z(t,e){this.board=t,this.color=e,t.actorsOf(e)}function G({piece:t,orig:e,dest:n,situationBefore:r,after:o,capture:i,promotion:l,castle:s,enpassant:u}){this.piece=t,this.orig=e,this.dest=n,this.situationBefore=()=>r,this.after=()=>o,this.before=()=>r.board,this.situationAfter=()=>new Z(o,B(t.color))}function X(t,e,n){let r=t.color;this.color=r,this.pos=e,this.pseudoValidMoves=function(){let i=[];switch(t.role){case"pawn":let t=s()(e),d=t;function f(o){let i=o(t);return i&&n.pieces[i.key]&&n.pieces[i.key].color!==r?c(i,n.taking(e,i),{capture:i}):null}let p=s()(d),h=[];p&&(h=c(p,n.move(e,p))),i.push([d&&l(d)||[],h,f((t=>t.left()))||[],f((t=>t.right()))||[]].flat());break;case"king":i.push(u(k.dirs)),i.push(o());break;case"knight":i.push(u(g.dirs));break;case"bishop":i.push(a(v.dirs));break;case"rook":i.push(a(b.dirs));break;case"queen":i.push(a(w.dirs))}return i.flatMap((t=>t))};const o=()=>i(H).concat(i(V));function i(t){let e=n.kingPosOf(r);if(!e)return[];let o=t.tripToRook(e,n),i=o[o.length-1],l=h.atfr(t.castledKingFile,e.rank),s=h.atfr(t.castledRookFile,i.rank),u={king:{[e.key]:l},rook:{[i.key]:s},side:t.name};return[c(e,n.take(e).take(i).place(k.color(r),l).place(b.color(r),s),{castle:u})]}function l(t){let r=n.move(e,t);return r?c(t,r):null}function s(){return function(t){return"white"===t?t=>t.up():t=>t.down()}(t.color)}function u(t){return t.flatMap((t=>t(e)||[])).flatMap((t=>{let r=n.move(e,t);return r?[c(t,r)]:[]}))}function a(t){let o=[];return t.forEach((t=>function t(i,l){let s;if(s=l(i)){let i=n.pieces[s.key];if(i){if(i.color!==r){let t=n.taking(e,s);o.push(c(s,t,{capture:s}))}}else{let r=n.move(e,s);r&&o.push(c(s,r)),t(s,l)}}}(e,t))),o}function c(r,o,i){let l,s,u,a;return i&&(l=i.capture,u=i.castle,s=i.promotion,a=i.enpassant),new G({piece:t,orig:e,dest:r,situationBefore:new Z(n,t.color),after:o,capture:l,castle:u,promotion:s,enpassant:a})}this.castleOn=i}function Y(t,e,n,r,o,i,l){function s(t,e){return!t||t===e}this.san=l,this.dest=t,this.role=e,this.capture=n,this.file=r,this.rank=o,this.promotion=i,this.move=n=>{let i=null;return u(n.board.pieces,((l,u)=>{if(!i&&u.color===n.color&&u.role===e.roleString&&s(r,h.fromKey(l).file.char)&&s(o,h.fromKey(l).rank.char)){let e=new X(u,h.fromKey(l),n.board);i=e.pseudoValidMoves().find((e=>e.dest.key===t.key))}})),i?q(i):D("No move found: "+l)}}function z(t,e){this.san=e,this.side=t,this.move=e=>{let n=W(e.board.kingPosOf(e.color),"No king found");if(n.invalid)return n;let r=W(e.board.actorAt(n.value.key),"No Actor found");return r.invalid?r:W(r.value.castleOn(t)[0],"Cannot castle")}}function U(t,e=[],n){let[r,...o]=t.split("."),i=document.createElement(r);return o.forEach((t=>{i.classList.add(t)})),e.forEach?e.forEach((t=>{i.appendChild(t)})):i.append(e),n&&n(i),i}Q.initial=()=>Q.fromFen("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),Q.fromFen=t=>{let{pieces:e,color:n}=$(t);return new Q(e,n)},Z.apply=()=>new Z(Q.initial(),"white");const J=(t,e,n)=>U("div"+t,e,n),tt=t=>document.createTextNode(t),et=(t,e)=>{for(t=t.firstChild;t;)e(t),t=t.nextSibling},nt=t=>e=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},rt=t=>e=>{t.split(".").forEach((t=>{e.classList.add(t)}))},ot=t=>e=>{Object.keys(t).forEach((n=>{e.setAttribute(n,t[n])}))},it=(t,e)=>n=>{n.addEventListener(t,(()=>{e(n)}))},lt=t=>{t.classList.contains("hidden")||t.classList.add("hidden")},st=t=>{t.classList.contains("hidden")&&t.classList.remove("hidden")};function ut(t,e=[]){let n=document.createElementNS("http://www.w3.org/2000/svg",t);return e.forEach&&e.forEach((t=>n.appendChild(t))),n}function at(t,e,n){let r,o=dt(P(t.orig),e);if(t.dest){let i=dt(P(t.dest),e);r=function(t,e,n,r){const o=function(t){return 10/512*t.width}(r),i=ft(e,r),l=ft(n,r),s=l[0]-i[0],u=l[1]-i[1],a=Math.atan2(u,s),c=Math.cos(a)*o,f=Math.sin(a)*o;return ht(ut("line"),{stroke:t.color,"stroke-width":ct(t,r),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+t.key+")",opacity:t.opacity,x1:i[0],y1:i[1],x2:l[0]-c,y2:l[1]-f})}(t.brush,o,i,n)}else r=function(t,e,n){const r=ft(e,n),o=function(t){return t.width/512*4}(n),i=(n.width+n.height)/32;return ht(ut("circle"),{stroke:t.color,"stroke-width":o,fill:"none",opacity:t.opacity,cx:r[0],cy:r[1],r:i-o/2})}(t.brush,o,n);return r}function ct(t,e){return(t.lineWidth||10)/512*e.width}function ft(t,e){return[(t[0]+.5)*e.width/8,(7.5-t[1])*e.height/8]}function dt(t,e){return"white"===e?t:[7-t[0],7-t[1]]}function pt(t){const e=ht(ut("marker"),{id:"arrowhead-"+t.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return e.appendChild(ht(ut("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),e.setAttribute("mdKey",t.key),e}function ht(t,e){for(const n in e)t.setAttribute(n,e[n]);return t}let{ranks:yt,files:mt,key2pos:gt,fPosToTranslateAbs:vt}=r,{svg:bt,renderMarker:wt,renderShape:kt}=i,{div:xt,tag:Et,fTranslateAbs:Ot,fListen:Ct,updateChildren:jt}=o;function St(t,e){switch(t){case 3:return function(t){return U("div",[],ot({"data-ply":t}))}(e);case 1:return function(t){return U("p",t.map((({type:t,content:e})=>{switch(t){case 1:return U("span",[],ot({"data-line":e}));case 2:return tt(e);default:return null}})))}(e);case 2:return U("h2",e);default:return null}}function Pt(t,e,n){let r,o,i,l,s,u,a,c,f,d,{history:p}=t;this.el=n,this.bounds=()=>c,this.init=t=>{if(r=t.game||"main",o=t.color,i=R(t.shapes),l=parseInt(t.ply),s={},u=[],a=p.moveFor(r,l)){let t=a.value.situationAfter();s=t.board.pieces,u.push(a.value.orig.key),u.push(a.value.dest.key)}o=o||p.colorFor(r),c=n.getBoundingClientRect()},this.syncVisible=()=>{c=n.getBoundingClientRect(),this.isInViewport=function(t){return t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth}(c)},this.render=()=>{d&&(d(),n.removeChild(f.wrapper)),this.wrap()},this.wrap=()=>{f=function(t,e,n,r,o){let i=A(t),l=vt(r),s=Et("md-board",[...o.map((t=>{let e=gt(t),n=Et("square.last-move",[],Ot(l(e,i)));return n.mdKey=t,n})),...Object.keys(e).map((t=>{let n=gt(t),r=e[t],o=Et(`piece.${r.color}.${r.role}`,[],Ot(l(n,i)));return o.mdKey=t,o}))]),u=bt("svg",[bt("defs",[wt(E)]),...n.map((e=>kt(e,t,r)))]);return{wrapper:Et("md-wrap",[s,u,Et("coords.ranks."+t,yt.map((t=>Et("coord",t)))),Et("coords.files."+t,mt.map((t=>Et("coord",t))))]),board:s,svg:u}}(o,s,i,c,u),n.appendChild(f.wrapper),d=function(t,e){const n=new window.ResizeObserver((()=>{!function(t,e){let n=e.getBoundingClientRect(),r=vt(n);jt(e,(e=>{Ot(r(gt(e.mdKey),t))(e)}))}(A(o),f.board),function(t,e,n){let{board:r,svg:o}=t,i=r.getBoundingClientRect(),l=o.firstChild,s=[];for(l=l.nextSibling;l;)s.push(l),l=l.nextSibling;for(const t of s)o.removeChild(t);e.forEach((t=>{o.appendChild(kt(t,n,i))}))}(f,i,o)}));return n.observe(t),()=>{n.unobserve(t)}}(n)}}function Lt(t,e,n){let r=n.dataset.game||"main initial",o=n.dataset.line,i=n.dataset.color,l=r.split(" ");1===l.length&&l.push("main"),this.game=l[0],this.base=l[1],this.color=i;let s=function(t){const e=/^(\d*)\.\.\.$/,n=/^(\d*)\.$/;let r,o,i=[];return t.split(" ").forEach((t=>{let l;if(l=t.match(e))o=2*parseInt(l[0]),r=[null];else if(l=t.match(n))o=2*parseInt(l[0])-1,r=[];else{let{value:e,invalid:n}=function(t){if("O-O"===t||"o-o"===t||"0-0"===t)return q(new z(H,t));if("O-O-O"===t||"o-o-o"===t||"0-0-0"===t)return q(new z(V,t));let e=t.match(/^(N|B|R|Q|K|)([a-h]?)([1-8]?)(x?)([a-h][1-8])(=?[NBQR]?)(\+?)(\#?)$/);if(!e)return n("Couldn't parse "+t);let[r,o,i,l,s,u,a,c,f]=e,d=h.fromKey(u);return u?q(new Y(d,x.forsyth(o)||m,""!==s,i,l,a,t)):n("Invalid move "+t)}(t);n?(console.warn(n),r.push(null)):(r.push({ply:o,move:e}),o++),2===r.length&&(i.push(r),r=[])}})),1===r.length&&i.push(r),i}(o);this.flat=s.flat().flatMap((t=>t?[t]:[]));let u=(e,n)=>{t.show(this.game,e,n)},a=()=>{t.hide()};this.wrap=()=>{let e=t.history.lineDepthFor(this.game),r=rt("depth"+e);(function(t,e,n){let r=t=>r=>{["touchstart","mouseover"].forEach((n=>Ct(n,(n=>e(t,n)))(r))),["touchend","mouseout"].forEach((t=>Ct(t,n)(r)))};return t.flatMap((([t,e])=>{let n=t&&r(t.ply),o=e&&r(e.ply);return t&&e?[Et("strong.moven",(t.ply+1)/2+". "),Et("span.movem",t.move.san+" ",n),Et("span.movem",e.move.san+" ",o)]:t?[Et("strong.moven",(t.ply+1)/2+". "),Et("span.movem",t.move.san+" ",n)]:[Et("strong.moven",e.ply/2+"... "),Et("span.movem",e.move.san+" ",o)]}))})(s,u,a).forEach((t=>n.appendChild(t))),r(n)}}function Mt(t,e){let{lines:n}=t,r=function(t,e){let n={};return t.forEach((t=>{let e=(t=>({[t.game]:t}))(t),r=Object.keys(e)[0];n[r]||(n[r]=[]),n[r].push(e[r])})),n}(n),o=Object.keys(r),i={},l={},a={};function c(t,e){return i[t].find((t=>t.ply===e))||(console.warn(`No move found for ${t} ${e}`),null)}function f(t,e){return 0===e?Z.apply():c(t,e).value.situationAfter()}function d(t,e){return t.map((({ply:t,move:n})=>{if(!e)return{ply:t,value:null};let{invalid:r,value:o}=n.move(e);return r?(console.warn(r),e=null,{ply:t,value:r}):(e=o.situationAfter(),{ply:t,value:o})})).filter((t=>t))}o.forEach((t=>{a[t]=function t(e){if("initial"===e||!r[e])return"white";let n=r[e][0];return n.color||t(n.base)}(t)})),function t(e,n,o){u(function(t){let e=s(function(t,e){let n={};for(let r in t)e(0,t[r])&&(n[r]=t[r]);return n}(r,((e,n)=>n[0].base===t)),((t,e)=>({[t]:e.flatMap((t=>t.flat)).sort(((t,e)=>t.ply<e.ply?-1:t.ply===e.ply?0:1))})));return s(e,((e,n)=>({[e]:d(n,f(t,n[0].ply-1))})))}(e),((e,r)=>{i[e]=r,l[e]=n,t(e,n+1)}))}("initial",0),this.lineDepthFor=t=>l[t],this.colorFor=t=>a[t],this.situationFor=f,this.moveFor=c}n.d(e,"Ply",(function(){return Pt})),n.d(e,"MoveLine",(function(){return Lt})),n.d(e,"History",(function(){return Mt})),n.d(e,"makePlys",(function(){return At})),n.d(e,"makeMoveLines",(function(){return Bt})),n.d(e,"Play",(function(){return Tt})),n.d(e,"app",(function(){return _t}));const At=(t,e)=>{let{element:n}=e,r=[];for(let o of n.querySelectorAll("[data-ply]")){let n=new Pt(t,e,o);n.init({game:o.dataset.game,color:o.dataset.color,shapes:o.dataset.shapes,ply:o.dataset.ply}),r.push(n)}return r},Bt=(t,e)=>{let{element:n}=e,r=[];for(let o of n.querySelectorAll("[data-line]"))r.push(new Lt(t,e,o));return r};function Tt(t){let{element:e}=t,n=this.lines=Bt(this,t),r=(this.history=new Mt(this,t),this.plys=At(this,t)),o=J(".hover-ply",[],lt),i=new Pt(this,t,o);this.wrap=()=>{e.appendChild(o),n.forEach((t=>t.wrap())),r.forEach((t=>t.wrap()))};let l=this.visiblePly=()=>r.filter((t=>t.isInViewport))[0];function s(){r.forEach((t=>t.syncVisible()))}this.listen=()=>{!function(t){let e;document.addEventListener("scroll",(function(n){clearTimeout(e),e=setTimeout(t,60)}),!1)}(s),s()},this.hide=()=>{lt(o)},this.show=(e,n,r)=>{let s=l(),u=[window.pageXOffset,window.pageYOffset];if(s)u[0]+=s.bounds().left,u[1]+=s.bounds().top;else{let{clientWidth:e}=t.element,n=r.getBoundingClientRect(),i=o.getBoundingClientRect();n.left<e/2&&(u[0]+=e-i.width-4)}nt(u)(o),i.init({game:e,ply:n}),i.render(),st(o)}}function _t(t,e){let n={element:t};e.content&&function(t,e){let n=[],r=e.firstChild;for(;r;)n.push(r),r=r.nextSibling;for(let t of n)e.removeChild(t);t.map((({type:t,content:e,pos:n})=>({pos:n,$_:St(t,e)}))).forEach((t=>{e.appendChild(t.$_)}))}(function(t){return function(t){const e=/^#([^\n]*)/,n=/^=([^\n]*)/;let r=[],o=[],i=t.split("\n"),l=0;if(i.forEach((t=>{if(""===t){if(r.length){let t=r.join("\n");o.push({type:1,pos:l,content:t}),r=[],l+=t.length+1}return void(l+=1)}let i;if(i=t.match(n)){let t=r.join("\n");r.length&&(o.push({type:1,pos:l,content:t}),r=[],l+=t.length+1),t=i[1],o.push({type:3,pos:l,content:t}),l+=t.length+2}else if(i=t.match(e)){let t=r.join("\n");r.length&&(o.push({type:1,pos:l,content:t}),r=[],l+=t.length+1),t=i[1],o.push({type:2,pos:l,content:t}),l+=t.length+2}else r.push(t)})),r.length){let t=r.join("\n");o.push({type:1,pos:l,content:t}),r=[],l+=t.length}return o}(t).map((t=>(1===t.type&&(t.content=function(t){return function(t){const e=/^</,n=/>$/;let r=2,o=[],i=[];return t.split(" ").forEach((t=>{let l;2===r?(l=t.match(e))?(i.push({type:2,content:o.join(" ")+" "}),r=1,o=[t],(l=t.match(n))&&(i.push({type:1,content:o.join(" ")}),r=2,o=[])):o.push(t):1===r&&((l=t.match(n))?(o.push(t),i.push({type:1,content:o.join(" ")}),r=2,o=[]):o.push(t))})),o.length>0&&i.push({type:r,content:o.join(" ")}),i}(t).map((t=>(1===t.type&&(t.content=function(t){return t.substring(1,t.length-1)}(t.content)),t)))}(t.content)),t)))}(e.content),t);let r=new Tt(n);r.wrap(),r.listen()}}])},function(t,e,n){t.exports=n(2)},function(t,e,n){n(3);const r=n(4);t.exports=r.app,console.log("[CisEditor]")},function(t,e,n){},function(t,e,n){"use strict";n.r(e);function r(t){return function(t){const e=/^#([^\n]*)/,n=/^=([^\n]*)/;let r=[],o=[],i=t.split("\n"),l=0;if(i.forEach((t=>{if(""===t){if(r.length){let t=r.join("\n");o.push({type:1,pos:l,content:t}),r=[],l+=t.length+1}return void(l+=1)}let i;if(i=t.match(n)){let t=r.join("\n");r.length&&(o.push({type:1,pos:l,content:t}),r=[],l+=t.length+1),t=i[1],o.push({type:3,pos:l,content:t}),l+=t.length+2}else if(i=t.match(e)){let t=r.join("\n");r.length&&(o.push({type:1,pos:l,content:t}),r=[],l+=t.length+1),t=i[1],o.push({type:2,pos:l,content:t}),l+=t.length+2}else r.push(t)})),r.length){let t=r.join("\n");o.push({type:1,pos:l,content:t}),r=[],l+=t.length}return o}(t).map((t=>(1===t.type&&(t.content=function(t){return function(t){const e=/^</,n=/>$/;let r=2,o=[],i=[];return t.split(" ").forEach((t=>{let l;2===r?(l=t.match(e))?(i.push({type:2,content:o.join(" ")+" "}),r=1,o=[t],(l=t.match(n))&&(i.push({type:1,content:o.join(" ")}),r=2,o=[])):o.push(t):1===r&&((l=t.match(n))?(o.push(t),i.push({type:1,content:o.join(" ")}),r=2,o=[]):o.push(t))})),o.length>0&&i.push({type:r,content:o.join(" ")}),i}(t).map((t=>(1===t.type&&(t.content=function(t){return t.substring(1,t.length-1)}(t.content)),t)))}(t.content)),t)))}function o(t,e=[],n){let[r,...o]=t.split("."),i=document.createElement(r);return o.forEach((t=>{i.classList.add(t)})),e.forEach?e.forEach((t=>{i.appendChild(t)})):i.append(e),n&&n(i),i}const i=(t,e)=>n=>{n.addEventListener(t,(t=>{e(n,t)}))},l=t=>e=>{Object.keys(t).forEach((n=>{e.setAttribute(n,t[n])}))};function s(t,e){let n=[],r=e.firstChild;for(;r;)n.push(r),r=r.nextSibling;for(let t of n)e.removeChild(t);let o=t.map((({type:t,content:e,pos:n})=>({pos:n,$_:u(t,e)})));return o.forEach((t=>{e.appendChild(t.$_)})),o}function u(t,e){switch(t){case 3:return function(t){return o("div",[],l({"data-ply":t}))}(e);case 1:return function(t){return o("p",t.map((({type:t,content:e})=>{switch(t){case 1:return o("span",[],l({"data-line":e}));case 2:return(t=>document.createTextNode(t))(e);default:return null}})))}(e);case 2:return o("h2",e);default:return null}}var a=n(0),c=n.n(a);function f(t,e={}){let n,{input:l,content:u=""}=e;l||(l=()=>{});let{$wrapper:a,$editor:f,$preview:d}=function({input:t,caret:e}){var n;let r=o("ch-editor",[o("textarea",[],(n=[i("input",((n,r)=>{e(r.target.selectionStart),t(n.value)}))],(...t)=>{n.forEach((e=>e(...t)))}))]),l=o("ch-preview");return{$wrapper:o("ch-wrap",[r,l]),$editor:r,$preview:l}}({content:u,caret:t=>{let e;for(let r in n){let o=n[r];if(!(o.pos<t))break;e=o}e&&function(t,e){let n=t.getBoundingClientRect();t.scrollTop=e.offsetTop-.3*n.width}(d,e.$_)},input:t=>{l(t),n=s(r(t),d);try{c()(d,{})}catch(t){}}});f.firstChild.value=u,n=s(r(f.firstChild.value),d);try{c()(d,{})}catch(t){}t.appendChild(a)}n.d(e,"app",(function(){return f}))}])}},e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{}};return t[r](o,o.exports,n),o.exports}return n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(973)})();